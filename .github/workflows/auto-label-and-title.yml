name: 🛠️ Auto Tag Issues from Title

on:
  issues:
    types: [opened, edited]

jobs:
  auto-label:
    runs-on: ubuntu-latest

    steps:
      - name: Process issue title and apply labels
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.issue.title;
            const issue_number = context.payload.issue.number;
            const repo = context.repo;

            const tagToEmoji = {
              '[bug]':  { emoji: '🐞', label: 'bug' },
              '[feature]': { emoji: '✨', label: 'feature' },
              '[cleanup]': { emoji: '🧹', label: 'cleanup' },
              '[infra]': { emoji: '🔧', label: 'infra' },
              '[idea]': { emoji: '🧠', label: 'idea' },
              '[tracking]': { emoji: '📌', label: 'tracking' },
              '[low]': { emoji: '⏳', label: 'low-priority' },
              '[high]': { emoji: '❗', label: 'high-priority' },
              '[project]': { emoji: '🚧', label: 'new project' }
            };

            for (const [tag, { emoji, label }] of Object.entries(tagToEmoji)) {
              if (title.toLowerCase().startsWith(tag)) {
                const newTitle = title.replace(tag, emoji).trim();

                // 1. Update title
                await github.rest.issues.update({
                  ...repo,
                  issue_number,
                  title: newTitle,
                });

                // 2. Apply label
                await github.rest.issues.addLabels({
                  ...repo,
                  issue_number,
                  labels: [label],
                });

                break;
              }
            }

